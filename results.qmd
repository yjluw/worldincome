# Results
```{r}
library(readxl)
library(ggplot2)
library(tidyverse)
data <- read_excel("WIID_28NOV2023.xlsx")
data <- data |>
  mutate(region_un = ifelse(country == "Turkiye", "Europe", region_un))
data_nomissing <- data[rowSums(is.na(data)) <= 4, ]
data_allpopuallarea <- data |> filter(popcovr == 'All', areacovr == 'All', scale == 'Per capita', resource == 'Income (net)')
```



```{r}
#| fig-height: 17
#| fig-width: 10

library(ggplot2)
library(dplyr)
library(tidyr)

data_median <- data |>
  group_by(country, year) |>        
  arrange(desc(!is.na(gini)),desc(!is.na(gini)),desc(popcovr == "All"),resource == "Earnings") |>
  slice(1) |> ungroup()  

data_avg <- data_median |>
  mutate(period = case_when(
    year >= 1950 & year <= 2000 ~ "1950-2000",
    year > 2000 & year <= 2022 ~ "2000-2022",
    TRUE ~ NA_character_
  )) |>
  filter(!is.na(period)) |>
  group_by(country, period) |>
  summarise(avg_gini = mean(gini, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(names_from = period, values_from = avg_gini) |>
  mutate(has_recent_data = ifelse(is.na(`2000-2022`), 0, 1)) |>
  arrange(has_recent_data, `2000-2022`) |>
  mutate(country_order = factor(country, levels = country)) 

ggplot(data_avg, aes(y = country_order)) +
  geom_point(aes(x = `2000-2022`, color = "2000-2022"), size = 2) +
  geom_point(aes(x = `1950-2000`, color = "1950-2000"), size = 2) +
  geom_segment(
    aes(x = `1950-2000`, xend = `2000-2022`, y = country_order, yend = country_order),
    color = "gray"
  ) +
  labs(
    title = "Comparison of Average Gini Coefficients (1950-2000 vs 2000-2022)",
    x = "Average Gini Coefficient",
    y = "Country",
    color = "Period"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 8),  
    legend.position = "right",             
    legend.title = element_text(size = 10), 
    legend.text = element_text(size = 9)   
  ) +
  scale_color_manual(values = c("1950-2000" = "red", "2000-2022" = "blue"))
```
```{r}
#| fig-height: 10
#| fig-width: 10
library(ggrepel)
n <- 5

top_countries_by_region <- data_median |>
  group_by(region_un, country) |>
  summarise(gini_range = max(gini, na.rm = TRUE) - min(gini, na.rm = TRUE), .groups = "drop") |>
  group_by(region_un) |>
  slice_max(gini_range, n = n) |>
  pull(country)

filtered_data <- data_median |>
  filter(country %in% top_countries_by_region)

start_points <- filtered_data |>
  group_by(region_un, country) |>
  filter(year == min(year)) |>
  ungroup()

ggplot(filtered_data, aes(x = year, y = gini)) +
  geom_point(aes(color = country), size = 1) +
  geom_smooth(aes(color = country), method = "loess", se = FALSE, size = 1.2, linetype = "solid") +
  #geom_line(aes(group = country, color = country)) +
  geom_text_repel(
    data = start_points,
    aes(label = country,color = country),
    size = 3,                  
    max.overlaps = 8,        
    force = 1,                 
    nudge_x = 3,               
    direction = "both",       
    segment.color = "gray50",  
    segment.size = 0.5,        
    segment.curvature = -0.2,  
    segment.ncp = 5,           
    segment.angle = 90            
  ) +
  facet_wrap(~ region_un, scales = "free",ncol=2) +
  labs(
    title = paste("Top", n, "Countries by Gini Coefficient Range in Each Region"),
    x = "Year",
    y = "Gini Coefficient",
    color = "Country"
  ) +
  theme_minimal() +
  theme(
    legend.position = "None", 
    legend.text = element_text(size = 8), 
    strip.text = element_text(size = 10) 
  )
```






```{r}


data_us <- data_median |>
  filter(country == "United States") |>
  select(year, gini, gdp) |>
  arrange(year) 


data_us <- data_us |>
  mutate(
    year_diff = year - lag(year),
    gdp_growth = ifelse(
      !is.na(year_diff) & year_diff > 0,  
      (gdp / lag(gdp))^(1 / year_diff) * 100 - 100,  
      NA 
    )
  ) |>
  select(-year_diff) 


ggplot(data_us, aes(x = year)) +
  geom_line(aes(y = gini, color = "Gini Index"), size = 1) +
  geom_point(aes(y = gini, color = "Gini Index"), size = 2) +
  geom_line(aes(y = gdp_growth, color = "GDP Growth"), size = 1) +
  geom_point(aes(y = gdp_growth, color = "GDP Growth"), size = 2) +
  scale_y_continuous(
    name = "Gini Index", 
    sec.axis = sec_axis(~ ., name = "GDP Growth (%)")  
  ) +
  scale_color_manual(
    name = "Indicator",
    values = c("Gini Index" = "blue", "GDP Growth" = "red")
  ) +
  labs(
    title = "GDP Growth and Gini Index Over Years for United States",
    x = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.y.left = element_text(size = 10),  
    axis.text.y.right = element_text(size = 10), 
    axis.text.x = element_text(size = 10),       
    axis.title.y.left = element_text(size = 12), 
    axis.title.y.right = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold"), 
    legend.position = "bottom",                  
    legend.title = element_text(size = 12),      
    legend.text = element_text(size = 10)        
  )
```
```{r}
data_us <- data_median |>
  filter(country == "China") |>
  select(year, gini, gdp) |>
  arrange(year) 


data_us <- data_us |>
  mutate(
    year_diff = year - lag(year),
    gdp_growth = ifelse(
      !is.na(year_diff) & year_diff > 0,  
      (gdp / lag(gdp))^(1 / year_diff) * 100 - 100,  
      NA 
    )
  ) |>
  select(-year_diff) 


ggplot(data_us, aes(x = year)) +
  geom_line(aes(y = gini, color = "Gini Index"), size = 1) +
  geom_point(aes(y = gini, color = "Gini Index"), size = 2) +
  geom_line(aes(y = gdp_growth, color = "GDP Growth"), size = 1) +
  geom_point(aes(y = gdp_growth, color = "GDP Growth"), size = 2) +
  scale_y_continuous(
    name = "Gini Index", 
    sec.axis = sec_axis(~ ., name = "GDP Growth (%)")  
  ) +
  scale_color_manual(
    name = "Indicator",
    values = c("Gini Index" = "blue", "GDP Growth" = "red")
  ) +
  labs(
    title = "GDP Growth and Gini Index Over Years for China",
    x = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.y.left = element_text(size = 10),  
    axis.text.y.right = element_text(size = 10), 
    axis.text.x = element_text(size = 10),       
    axis.title.y.left = element_text(size = 12), 
    axis.title.y.right = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold"), 
    legend.position = "bottom",                  
    legend.title = element_text(size = 12),      
    legend.text = element_text(size = 10)        
  )
```


```{r}


data_us <- data_median |>
  filter(country == "Japan") |>
  select(year, gini, gdp) |>
  arrange(year) 


data_us <- data_us |>
  mutate(
    year_diff = year - lag(year),
    gdp_growth = ifelse(
      !is.na(year_diff) & year_diff > 0,  
      (gdp / lag(gdp))^(1 / year_diff) * 100 - 100,  
      NA 
    )
  ) |>
  select(-year_diff) 


ggplot(data_us, aes(x = year)) +
  geom_line(aes(y = gini, color = "Gini Index"), size = 1) +
  geom_point(aes(y = gini, color = "Gini Index"), size = 2) +
  geom_line(aes(y = gdp_growth, color = "GDP Growth"), size = 1) +
  geom_point(aes(y = gdp_growth, color = "GDP Growth"), size = 2) +
  scale_y_continuous(
    name = "Gini Index", 
    sec.axis = sec_axis(~ ., name = "GDP Growth (%)")  
  ) +
  scale_color_manual(
    name = "Indicator",
    values = c("Gini Index" = "blue", "GDP Growth" = "red")
  ) +
  labs(
    title = "GDP Growth and Gini Index Over Years for Japan",
    x = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.y.left = element_text(size = 10),  
    axis.text.y.right = element_text(size = 10), 
    axis.text.x = element_text(size = 10),       
    axis.title.y.left = element_text(size = 12), 
    axis.title.y.right = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold"), 
    legend.position = "bottom",                  
    legend.title = element_text(size = 12),      
    legend.text = element_text(size = 10)        
  )
```


```{r}
coun <- "Burkina Faso"

data_us <- data_median |>
  filter(country == coun) |>
  select(year, gini, gdp) |>
  arrange(year) 


data_us <- data_us |>
  mutate(
    year_diff = year - lag(year),
    gdp_growth = ifelse(
      !is.na(year_diff) & year_diff > 0,  
      (gdp / lag(gdp))^(1 / year_diff) * 100 - 100,  
      NA 
    )
  ) |>
  select(-year_diff) 


ggplot(data_us, aes(x = year)) +
  geom_line(aes(y = gini, color = "Gini Index"), size = 1) +
  geom_point(aes(y = gini, color = "Gini Index"), size = 2) +
  geom_line(aes(y = gdp_growth, color = "GDP Growth"), size = 1) +
  geom_point(aes(y = gdp_growth, color = "GDP Growth"), size = 2) +
  scale_y_continuous(
    name = "Gini Index", 
    sec.axis = sec_axis(~ ., name = "GDP Growth (%)")  
  ) +
  scale_color_manual(
    name = "Indicator",
    values = c("Gini Index" = "blue", "GDP Growth" = "red")
  ) +
  labs(
    title = paste("GDP Growth and Gini Index Over Years for ",coun),
    x = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.y.left = element_text(size = 10),  
    axis.text.y.right = element_text(size = 10), 
    axis.text.x = element_text(size = 10),       
    axis.title.y.left = element_text(size = 12), 
    axis.title.y.right = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold"), 
    legend.position = "bottom",                  
    legend.title = element_text(size = 12),      
    legend.text = element_text(size = 10)        
  )
```

```{r}

coun <- "South Africa"

data_us <- data_median |>
  filter(country == coun) |>
  select(year, gini, gdp) |>
  arrange(year) 


data_us <- data_us |>
  mutate(
    year_diff = year - lag(year),
    gdp_growth = ifelse(
      !is.na(year_diff) & year_diff > 0,  
      (gdp / lag(gdp))^(1 / year_diff) * 100 - 100,  
      NA 
    )
  ) |>
  select(-year_diff) 


ggplot(data_us, aes(x = year)) +
  geom_line(aes(y = gini, color = "Gini Index"), size = 1) +
  geom_point(aes(y = gini, color = "Gini Index"), size = 2) +
  geom_line(aes(y = gdp_growth, color = "GDP Growth"), size = 1) +
  geom_point(aes(y = gdp_growth, color = "GDP Growth"), size = 2) +
  scale_y_continuous(
    name = "Gini Index", 
    sec.axis = sec_axis(~ ., name = "GDP Growth (%)")  
  ) +
  scale_color_manual(
    name = "Indicator",
    values = c("Gini Index" = "blue", "GDP Growth" = "red")
  ) +
  labs(
    title = paste("GDP Growth and Gini Index Over Years for ",coun),
    x = "Year"
  ) +
  theme_minimal() +
  theme(
    axis.text.y.left = element_text(size = 10),  
    axis.text.y.right = element_text(size = 10), 
    axis.text.x = element_text(size = 10),       
    axis.title.y.left = element_text(size = 12), 
    axis.title.y.right = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold"), 
    legend.position = "bottom",                  
    legend.title = element_text(size = 12),      
    legend.text = element_text(size = 10)        
  )
```
```